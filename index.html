<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ä¸ˆå…«ä¸€è·¯é…’åº—ä¿¡æ¯ç®¡ç†</title>
    <style>
        body{font-family:"Helvetica Neue",system-ui,sans-serif;margin:0;padding:0;background-color:#f8f9fb;min-height:100vh;position:relative}.container{max-width:1200px;margin:0 auto;padding:20px;padding-bottom:126px}.home{text-align:center;padding:20px}.home h1{margin-bottom:22px;color:#1a1d1f;font-size:28px;font-weight:600;letter-spacing:0.5px}#searchInput,#searchStatus{padding:12px 14px;margin:10px 0;width:100%;max-width:560px;border-radius:10px;border:2px solid #e2e4e8;box-sizing:border-box;font-size:16px;height:47px;transition:border-color 0.2s}#searchInput:focus,#searchStatus:focus{border-color:#3a6ea5;outline:none}.search-wrapper{position:relative;max-width:560px;margin:0 auto}.search-icon{position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:18px}.distance-options{margin:18px auto;display:grid;grid-template-columns:repeat(2,1fr);gap:10px;max-width:560px}.distance-options label{padding:12px;border:2px solid #e2e4e8;border-radius:10px;background:white;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:15px;color:#454950;transition:all 0.2s}.distance-options label:hover{border-color:#3a6ea5}.button-group{max-width:560px;margin:20px auto;display:flex;justify-content:center;gap:18px;width:100%}.button-style{flex:none;padding:14px;background-color:#3a6ea5;color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px;transition:all 0.2s;width:108px;height:47px;font-weight:500;box-shadow:0 3px 6px rgba(58,110,165,0.15)}.button-style:hover{background-color:#2c5680;box-shadow:0 4px 8px rgba(58,110,165,0.25)}.header{position:sticky;top:0;background-color:#fff;padding:16px 20px;border-bottom:2px solid #e2e4e8;z-index:1000;display:none;align-items:center;justify-content:space-between}.header h1{font-size:20px;margin:0;color:#1a1d1f;font-weight:600}.hotel-list{display:none}.hotel-item{border:2px solid #e2e4e8;margin:18px 0;padding:20px;background-color:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}.hotel-item.collapsed .details{display:none}.hotel-name{margin-bottom:10px;cursor:pointer;line-height:1.2}.controls-container{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.detail-item{margin:10px 0;display:flex;align-items:center;gap:0}.detail-item label{min-width:48px;font-size:15px;color:#5f6368;font-weight:500}.detail-item input,.detail-item textarea{flex:1;padding:7px;border:2px solid #e2e4e8;border-radius:7px;font-size:15px;height:32px;transition:border-color 0.2s}.detail-item textarea{height:54px;resize:vertical;line-height:1.4}.distance-row{display:flex;align-items:center;gap:6px}.distance-input{width:50px;padding:6px;border-radius:7px;border:2px solid #e2e4e8;height:32px}.footer-buttons{position:fixed;bottom:0;left:0;right:0;background-color:#fff;padding:18px;border-top:2px solid #e2e4e8;z-index:1000;display:flex;justify-content:center;gap:18px}.small-button{padding:9px 20px;font-size:14px;min-width:72px;height:34px;border-radius:7px;font-weight:500}.save-notice{position:fixed;top:25px;left:50%;transform:translateX(-50%);background:#3a6ea5;color:white;padding:12px 24px;border-radius:9px;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:15px}.distance-link{color:#3a6ea5;cursor:pointer;float:right;font-weight:500;font-size:15px;transition:opacity 0.2s}.distance-link:hover{opacity:0.8}.import-export{position:absolute;top:18px;right:18px;display:flex;gap:6px}.import-export button{padding:5px 10px;font-size:12px;background:#3a6ea5;color:white;border:none;border-radius:4px;cursor:pointer;transition:all 0.2s}.import-export button:hover{background:#2c5680}.delete-btn{background:#ff4757!important;margin-left:6px;padding:3px 6px;border-radius:3px;font-size:12px;height:26px}.new-hotel-form{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:11px;box-shadow:0 0 18px rgba(0,0,0,0.2);z-index:1001;width:90%;max-width:600px;display:none}.button-group.vertical{flex-direction:column}
        .save-btn { background-color: #888 !important; }
        .fold-btn { background-color: #888 !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="import-export">
            <button onclick="exportData()">å¯¼å‡º</button>
            <button onclick="document.getElementById('importInput').click()">å¯¼å…¥</button>
            <input type="file" id="importInput" style="display:none" onchange="importData(event)">
        </div>

        <div class="home" id="homePage">
            <h1>ä¸ˆå…«ä¸€è·¯é…’åº—ä¿¡æ¯</h1>
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="æŒ‰é…’åº—åç§°æœç´¢..." onkeypress="handleSearchKeyPress(event)">
                <span class="search-icon" onclick="searchHotels()">ğŸ”</span>
            </div>
            <select id="searchStatus">
                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                <option value="å¾…å®š">å¾…å®š</option>
                <option value="è·Ÿè¿›">è·Ÿè¿›</option>
                <option value="åˆä½œ">åˆä½œ</option>
                <option value="æ”¾å¼ƒ">æ”¾å¼ƒ</option>
            </select>
            <div class="distance-options">
                <label><input type="checkbox" name="distance" value="all" checked> å…¨éƒ¨</label>
                <label><input type="checkbox" name="distance" value="0-1"> 1kmå†…</label>
                <label><input type="checkbox" name="distance" value="1-2"> 1-2km</label>
                <label><input type="checkbox" name="distance" value="2-3"> 2-3km</label>
                <label><input type="checkbox" name="distance" value="3-4"> 3-4km</label>
                <label><input type="checkbox" name="distance" value="4+"> 4km+</label>
            </div>
            <div class="button-group">
                <button class="button-style" onclick="searchHotels()">é…’åº—æœç´¢</button>
                <button class="button-style" onclick="showRandomHotels()">éšæœºæ¨è</button>
            </div>
            <div class="button-group" style="margin-top:18px">
                <button class="button-style" onclick="showNewHotelForm()">æ–°å¢é…’åº—</button>
            </div>
        </div>

        <div class="new-hotel-form" id="newHotelForm">
            <div class="hotel-item">
                <div class="hotel-name">
                    <div class="controls-container">
                        <div>æ–°å»ºé…’åº—ä¿¡æ¯</div>
                        <button class="delete-btn" onclick="closeNewHotelForm()">å…³é—­</button>
                    </div>
                </div>
                <div class="details">
                    <div class="detail-item">
                        <label>åç§°ï¼š</label>
                        <input id="newHotelName">
                    </div>
                    <div class="detail-item">
                        <label>åœ°å€ï¼š</label>
                        <input id="newHotelAddress">
                    </div>
                    <div class="detail-item">
                        <label>ç”µè¯ï¼š</label>
                        <input id="newHotelPhone">
                    </div>
                    <div class="detail-item">
                        <label>æˆ¿é—´ï¼š</label>
                        <input id="newHotelRooms">
                    </div>
                    <div class="detail-item">
                        <label>è·ç¦»ï¼š</label>
                        <div class="distance-row">
                            <input class="distance-input" type="number" step="0.1" id="newHotelDistance">
                            <span>km</span>
                        </div>
                    </div>
                    <div class="button-group vertical">
                        <button class="button-style" onclick="saveNewHotel()">ä¿å­˜é…’åº—</button>
                        <button class="button-style" onclick="closeNewHotelForm()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="header" id="listHeader">
            <h1>é…’åº—è¯¦æƒ…</h1>
            <button class="small-button" id="toggleBtn" onclick="toggleDetails(event)">å±•å¼€</button>
        </div>
        <div class="hotel-list" id="hotelList"></div>
    </div>

    <div class="footer-buttons">
        <button class="button-style" onclick="showHome()">è¿”å›é¦–é¡µ</button>
        <button class="button-style" onclick="openLifeMuseum()">æ¬¢å–œç”Ÿæ´»é¦†</button>
    </div>
    
    <div class="save-notice" id="saveNotice">âœ“ ä¿å­˜æˆåŠŸï¼</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
        // åˆå§‹åŒ–FastClickæ¶ˆé™¤ç‚¹å‡»å»¶è¿Ÿ
        if ('addEventListener' in document) {
            document.addEventListener('DOMContentLoaded', function() {
                FastClick.attach(document.body);
            }, false);
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno) {
            alert('å‘ç”Ÿé”™è¯¯: ' + message + '\nè¡Œå·: ' + lineno);
            return true;
        };

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        const savedData = JSON.parse(localStorage.getItem('hotelData')) || {};
        let fullHotels = savedData.fullHotels || [
            {name:"æ¡”å­é…’åº— (è¥¿å®‰é«˜æ–°åŒºé”¦ä¸šè·¯åº—)",address:"ä¸ˆå…«ä¸€è·¯ä¸é”¦ä¸šè·¯äº¤å‰å£ä¸œåŒ—è§’æ—ºéƒ½å¤§å¦Cåº§5æ¥¼",phone:"+86 29-6825-9777",rooms:"çº¦80-100é—´",distance:0.4},
            {name:"å¦‚å®¶ç²¾é€‰é…’åº— (è¥¿å®‰é«˜æ–°åŒºé”¦ä¸šä¸€è·¯ä¸ˆå…«å››è·¯åœ°é“ç«™åº—)",address:"é”¦ä¸šä¸€è·¯56å·",phone:"+86 29-6859-6666",rooms:"çº¦100-120é—´",distance:1.4},
            {name:"å…¨ä½é…’åº—(åŠå¯¼ä½“äº§ä¸šå›­ä¸ˆå…«å…­è·¯åœ°é“å£åº—)",address:"é”¦ä¸šè·¯é™„è¿‘",phone:"+86 29-8866-1234",rooms:"çº¦60-80é—´",distance:0.5}
        ];
        let currentDisplayedIndexes = [];

        function saveAllData() {
            savedData.fullHotels = fullHotels;
            localStorage.setItem('hotelData', JSON.stringify(savedData));
        }

        function generateHotelList(hotels) {
            const hotelList = document.getElementById('hotelList');
            hotelList.innerHTML = '';
            currentDisplayedIndexes = [];
            
            hotels.forEach((hotel) => {
                const originalIndex = fullHotels.findIndex(h => h === hotel);
                if (originalIndex === -1) return;

                if (!savedData[originalIndex]) {
                    savedData[originalIndex] = {
                        status: 'å¾…å®š',
                        remarks: '',
                        collapsed: true,
                        distance: hotel.distance,
                        address: hotel.address,
                        phone: hotel.phone,
                        rooms: hotel.rooms,
                        editable: false
                    };
                }
                currentDisplayedIndexes.push(originalIndex);

                const saved = savedData[originalIndex];
                const item = document.createElement('div');
                item.className = `hotel-item${saved.collapsed ? ' collapsed' : ''}`;
                
                item.innerHTML = `
                    <div class="hotel-name" onclick="toggleHotel(${originalIndex}, event)">
                        <div class="controls-container">
                            <div class="controls">
                                <select onchange="updateStatus(${originalIndex}, this.value)" style="padding:4px;border-radius:4px">
                                    ${['å¾…å®š','è·Ÿè¿›','åˆä½œ','æ”¾å¼ƒ'].map(v => `<option ${saved.status === v ? 'selected' : ''}>${v}</option>`).join('')}
                                </select>
                                ${saved.editable ? `<button class="delete-btn" onclick="deleteHotel(${originalIndex}, event)">åˆ é™¤</button>` : ''}
                            </div>
                            <span class="distance-link" onclick="openMap('${hotel.name}')">${(saved.distance || hotel.distance).toFixed(1)}km</span>
                        </div>
                        <div style="margin-top:6px">${hotel.name}</div>
                    </div>
                    <div class="details">
                        <div class="detail-item">
                            <label>åœ°å€ï¼š</label>
                            <input value="${saved.address || hotel.address}" onchange="updateAddress(${originalIndex}, this.value)" ${saved.editable ? '' : 'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>ç”µè¯ï¼š</label>
                            <input value="${saved.phone || hotel.phone}" onchange="updatePhone(${originalIndex}, this.value)" ${saved.editable ? '' : 'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>æˆ¿é—´ï¼š</label>
                            <input value="${saved.rooms || hotel.rooms}" onchange="updateRooms(${originalIndex}, this.value)" ${saved.editable ? '' : 'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>å¤‡æ³¨ï¼š</label>
                            <textarea onchange="updateRemarks(${originalIndex}, this.value)" ${saved.editable ? '' : 'disabled'}>${saved.remarks || ''}</textarea>
                        </div>
                        <div class="detail-item">
                            <label>è·ç¦»ï¼š</label>
                            <div class="distance-row">
                                <input class="distance-input" type="number" step="0.1" value="${(saved.distance || hotel.distance).toFixed(1)}" onchange="updateDistance(${originalIndex}, this.value)" ${saved.editable ? '' : 'disabled'}>
                                <span>km</span>
                                <button class="small-button ${saved.editable ? 'save-btn' : ''}" onclick="toggleEdit(${originalIndex}, event)">${saved.editable ? 'ä¿å­˜' : 'ä¿®æ”¹'}</button>
                            </div>
                        </div>
                    </div>`;
                hotelList.appendChild(item);
            });
            saveAllData();
            document.getElementById('listHeader').style.display = 'flex';
            hotelList.style.display = 'block';
        }

        function toggleDetails(event) {
            try {
                event.preventDefault();
                const btn = document.getElementById('toggleBtn');
                const isCollapsed = btn.textContent === 'å±•å¼€';
                btn.textContent = isCollapsed ? 'æŠ˜å ' : 'å±•å¼€';
                btn.classList.toggle('fold-btn', !isCollapsed);
                
                document.querySelectorAll('.hotel-item').forEach((item, index) => {
                    const originalIndex = currentDisplayedIndexes[index];
                    if (originalIndex !== undefined && savedData[originalIndex]) {
                        item.classList.toggle('collapsed', !isCollapsed);
                        savedData[originalIndex].collapsed = !isCollapsed;
                    }
                });
                
                saveAllData();
                event.stopPropagation();
            } catch (e) {
                alert('æ“ä½œå¤±è´¥: ' + e.message);
            }
        }

        function deleteHotel(index, event) {
            try {
                event.preventDefault();
                if (confirm("ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¯¥é…’åº—å—ï¼Ÿ")) {
                    fullHotels.splice(index, 1);
                    delete savedData[index];
                    saveAllData();
                    searchHotels();
                }
                event.stopPropagation();
            } catch (e) {
                alert('åˆ é™¤å¤±è´¥: ' + e.message);
            }
        }

        function showNewHotelForm() {
            document.getElementById('newHotelForm').style.display = 'block';
            ['Name','Address','Phone','Rooms','Distance'].forEach(id => {
                document.getElementById(`newHotel${id}`).value = '';
            });
        }

        function closeNewHotelForm() {
            document.getElementById('newHotelForm').style.display = 'none';
        }

        function saveNewHotel() {
            try {
                const newHotel = {
                    name: document.getElementById('newHotelName').value.trim(),
                    address: document.getElementById('newHotelAddress').value.trim(),
                    phone: document.getElementById('newHotelPhone').value.trim(),
                    rooms: document.getElementById('newHotelRooms').value.trim(),
                    distance: parseFloat(document.getElementById('newHotelDistance').value)
                };
                if (!newHotel.name || isNaN(newHotel.distance)) throw new Error('è¯·å¡«å†™é…’åº—åç§°å’Œæœ‰æ•ˆè·ç¦»');

                fullHotels.push(newHotel);
                const newIndex = fullHotels.length - 1;
                savedData[newIndex] = {
                    status: 'å¾…å®š',
                    remarks: '',
                    collapsed: false,
                    editable: true,
                    ...newHotel
                };
                saveAllData();
                closeNewHotelForm();
                showSaveNotice('é…’åº—æ·»åŠ æˆåŠŸï¼');
                searchHotels();
            } catch (e) {
                alert(e.message);
            }
        }

        function exportData() {
            const data = {
                fullHotels: fullHotels,
                savedData: savedData,
                version: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `é…’åº—æ•°æ®_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        function importData(event) {
            try {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = JSON.parse(e.target.result);
                    if (!data.fullHotels || !data.savedData) throw new Error('æ— æ•ˆæ•°æ®æ–‡ä»¶');

                    if (confirm("å¯¼å…¥æ•°æ®å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ")) {
                        fullHotels = data.fullHotels;
                        Object.assign(savedData, data.savedData);
                        saveAllData();
                        alert('å¯¼å…¥æˆåŠŸï¼Œå³å°†åˆ·æ–°é¡µé¢');
                        location.reload();
                    }
                };
                reader.readAsText(file);
            } catch (e) {
                alert('æ–‡ä»¶è§£æå¤±è´¥: ' + e.message);
            }
        }

        function showSaveNotice(message) {
            const notice = document.getElementById('saveNotice');
            notice.textContent = message;
            notice.style.display = 'block';
            setTimeout(() => notice.style.display = 'none', 2000);
        }

        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') searchHotels();
        }

        function searchHotels() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('searchStatus').value;
            const distanceCheckboxes = document.querySelectorAll('.distance-options input[type="checkbox"]:checked');
            const distanceRanges = Array.from(distanceCheckboxes).map(c => c.value);
            
            let filtered = fullHotels.filter(hotel => {
                const nameMatch = hotel.name.toLowerCase().includes(searchTerm);
                const originalIndex = fullHotels.indexOf(hotel);
                const statusMatch = !statusFilter || (savedData[originalIndex]?.status === statusFilter);
                const distance = hotel.distance;
                const distanceMatch = distanceRanges.some(range => {
                    if (range === 'all') return true;
                    if (range === '0-1') return distance <= 1;
                    if (range === '1-2') return distance > 1 && distance <= 2;
                    if (range === '2-3') return distance > 2 && distance <= 3;
                    if (range === '3-4') return distance > 3 && distance <= 4;
                    if (range === '4+') return distance > 4;
                    return false;
                });
                return nameMatch && statusMatch && distanceMatch;
            });
            generateHotelList(filtered);
            document.getElementById('homePage').style.display = 'none';
        }

        function showRandomHotels() {
            const randomHotels = fullHotels.sort(() => Math.random() - 0.5).slice(0, 5);
            generateHotelList(randomHotels);
            document.getElementById('homePage').style.display = 'none';
        }

        function toggleHotel(index, event) {
            try {
                event.preventDefault();
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'SELECT' || event.target.tagName === 'BUTTON') return;
                const hotelItem = event.currentTarget.closest('.hotel-item');
                hotelItem.classList.toggle('collapsed');

                if (!savedData[index]) {
                    savedData[index] = {
                        status: 'å¾…å®š',
                        remarks: '',
                        collapsed: true,
                        distance: fullHotels[index].distance,
                        address: fullHotels[index].address,
                        phone: fullHotels[index].phone,
                        rooms: fullHotels[index].rooms,
                        editable: false
                    };
                }
                savedData[index].collapsed = !savedData[index].collapsed;
                saveAllData();
                event.stopPropagation();
            } catch (e) {
                alert('æ“ä½œå¤±è´¥: ' + e.message);
            }
        }

        function updateStatus(index, value) {
            if (!savedData[index]) return;
            savedData[index].status = value;
            saveAllData();
        }

        function updateAddress(index, value) {
            if (!savedData[index]) return;
            savedData[index].address = value;
            saveAllData();
        }

        function updatePhone(index, value) {
            if (!savedData[index]) return;
            savedData[index].phone = value;
            saveAllData();
        }

        function updateRooms(index, value) {
            if (!savedData[index]) return;
            savedData[index].rooms = value;
            saveAllData();
        }

        function updateRemarks(index, value) {
            if (!savedData[index]) return;
            savedData[index].remarks = value;
            saveAllData();
        }

        function updateDistance(index, value) {
            if (!savedData[index]) return;
            savedData[index].distance = parseFloat(value);
            saveAllData();
        }

        function toggleEdit(index, event) {
            try {
                event.preventDefault();
                if (!savedData[index]) return;
                savedData[index].editable = !savedData[index].editable;
                saveAllData();
                searchHotels();
                event.stopPropagation();
            } catch (e) {
                alert('ä¿®æ”¹å¤±è´¥: ' + e.message);
            }
        }

        function showHome() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('listHeader').style.display = 'none';
            document.getElementById('hotelList').style.display = 'none';
        }

        function openMap(name) {
            window.open(`https://uri.amap.com/search?query=${encodeURIComponent(name)}&city=è¥¿å®‰}`, '_blank');
        }

        function openLifeMuseum() {
            window.open('https://www.thisnet.cn/wxurl/mini.php', '_blank');
        }

        // åˆå§‹åŒ–æ˜¾ç¤ºé¦–é¡µ
        showHome();
    </script>
</body>
</html>
