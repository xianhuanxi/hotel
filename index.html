<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ˆå…«ä¸€è·¯é…’åº—ä¿¡æ¯ç®¡ç†</title>
    <style>
        body{font-family:"Helvetica Neue",system-ui,sans-serif;margin:0;padding:0;background-color:#f8f9fb;min-height:100vh;position:relative}.container{max-width:1200px;margin:0 auto;padding:24px;padding-bottom:140px}.home{text-align:center;padding:24px}.home h1{margin-bottom:28px;color:#1a1d1f;font-size:28px;font-weight:600;letter-spacing:0.5px}#searchInput,#searchStatus{padding:14px 16px;margin:12px 0;width:100%;max-width:560px;border-radius:10px;border:2px solid #e2e4e8;box-sizing:border-box;font-size:16px;height:52px;transition:border-color 0.2s}#searchInput:focus,#searchStatus:focus{border-color:#4a90e2;outline:none}.distance-options{margin:20px auto;display:grid;grid-template-columns:repeat(2,1fr);gap:12px;max-width:560px}.distance-options label{padding:14px;border:2px solid #e2e4e8;border-radius:10px;background:white;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:15px;color:#454950;transition:all 0.2s}.distance-options label:hover{border-color:#4a90e2}.button-group{max-width:560px;margin:24px auto;display:flex;justify-content:center;gap:20px;width:100%}.button-style{flex:none;padding:16px;background-color:#4a90e2;color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px;transition:all 0.2s;width:180px;height:52px;font-weight:500;box-shadow:0 3px 6px rgba(74,144,226,0.15)}.button-style:hover{background-color:#357abd;box-shadow:0 4px 8px rgba(74,144,226,0.25)}.header{position:sticky;top:0;background-color:#fff;padding:18px 24px;border-bottom:2px solid #e2e4e8;z-index:1000;display:none;align-items:center;justify-content:space-between}.header h1{font-size:20px;margin:0;color:#1a1d1f;font-weight:600}.hotel-list{display:none}.hotel-item{border:2px solid #e2e4e8;margin:20px 0;padding:24px;background-color:#fff;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.05)}.hotel-item.collapsed .details{display:none}.hotel-name{margin-bottom:12px;cursor:pointer}.controls-container{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.detail-item{margin:12px 0;display:flex;align-items:center;gap:0px}.detail-item label{min-width:48px;font-size:15px;color:#5f6368;font-weight:500}.detail-item input,.detail-item textarea{flex:1;padding:8px;border:2px solid #e2e4e8;border-radius:8px;font-size:15px;height:36px;transition:border-color 0.2s}.detail-item textarea{height:60px;resize:vertical;line-height:1.5;white-space:pre-wrap}.distance-row{display:flex;align-items:center;gap:8px}.distance-input{width:100px;padding:8px;border-radius:8px;border:2px solid #e2e4e8;height:36px}.footer-buttons{position:fixed;bottom:0;left:0;right:0;background-color:#fff;padding:22px;border-top:2px solid #e2e4e8;z-index:1000;display:flex;justify-content:center;gap:20px}.small-button{padding:10px 24px;font-size:14px;min-width:80px;height:38px;border-radius:8px;font-weight:500}.save-notice{position:fixed;top:28px;left:50%;transform:translateX(-50%);background:#4a90e2;color:white;padding:14px 28px;border-radius:10px;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:15px}.distance-link{color:#4a90e2;cursor:pointer;float:right;font-weight:500;font-size:15px;transition:opacity 0.2s}.distance-link:hover{opacity:0.8}.import-export{position:absolute;top:20px;right:20px;display:flex;gap:8px}.import-export button{padding:6px 12px;font-size:12px;background:#4a90e2;color:white;border:none;border-radius:4px;cursor:pointer;transition:all 0.2s}.import-export button:hover{background:#357abd}.delete-btn{background:#ff4757!important;margin-left:8px;padding:4px 8px;border-radius:4px;font-size:12px;height:28px}.new-hotel-form{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:24px;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,0.2);z-index:1001;width:90%;max-width:600px;display:none}.button-group.vertical{flex-direction:column}
    </style>
</head>
<body>
    <div class="container">
        <div class="import-export">
            <button onclick="exportData()">å¯¼å‡º</button>
            <button onclick="document.getElementById('importInput').click()">å¯¼å…¥</button>
            <input type="file" id="importInput" style="display:none" onchange="importData(event)">
        </div>

        <div class="home" id="homePage">
            <h1>ä¸ˆå…«ä¸€è·¯é…’åº—ä¿¡æ¯</h1>
            <input type="text" id="searchInput" placeholder="æŒ‰é…’åº—åç§°æœç´¢...">
            <select id="searchStatus">
                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                <option value="å¾…å®š">å¾…å®š</option>
                <option value="è·Ÿè¿›">è·Ÿè¿›</option>
                <option value="åˆä½œ">åˆä½œ</option>
                <option value="æ”¾å¼ƒ">æ”¾å¼ƒ</option>
            </select>
            <div class="distance-options">
                <label><input type="checkbox" name="distance" value="all" checked> å…¨éƒ¨</label>
                <label><input type="checkbox" name="distance" value="0-1"> 1kmå†…</label>
                <label><input type="checkbox" name="distance" value="1-2"> 1-2km</label>
                <label><input type="checkbox" name="distance" value="2-3"> 2-3km</label>
                <label><input type="checkbox" name="distance" value="3-4"> 3-4km</label>
                <label><input type="checkbox" name="distance" value="4+"> 4km+</label>
            </div>
            <div class="button-group">
                <button class="button-style" onclick="searchHotels()">é…’åº—æœç´¢</button>
                <button class="button-style" onclick="showRandomHotels()">éšæœºæ¨è</button>
            </div>
            <div class="button-group" style="margin-top:20px">
                <button class="button-style" onclick="showNewHotelForm()">æ–°å¢é…’åº—</button>
            </div>
        </div>

        <div class="new-hotel-form" id="newHotelForm">
            <div class="hotel-item">
                <div class="hotel-name">
                    <div class="controls-container">
                        <div>æ–°å»ºé…’åº—ä¿¡æ¯</div>
                        <button class="delete-btn" onclick="closeNewHotelForm()">å…³é—­</button>
                    </div>
                </div>
                <div class="details">
                    <div class="detail-item">
                        <label>åç§°ï¼š</label>
                        <input id="newHotelName">
                    </div>
                    <div class="detail-item">
                        <label>åœ°å€ï¼š</label>
                        <input id="newHotelAddress">
                    </div>
                    <div class="detail-item">
                        <label>ç”µè¯ï¼š</label>
                        <input id="newHotelPhone">
                    </div>
                    <div class="detail-item">
                        <label>æˆ¿é—´ï¼š</label>
                        <input id="newHotelRooms">
                    </div>
                    <div class="detail-item">
                        <label>è·ç¦»ï¼š</label>
                        <div class="distance-row">
                            <input class="distance-input" type="number" step="0.1" id="newHotelDistance">
                            <span>km</span>
                        </div>
                    </div>
                    <div class="button-group vertical">
                        <button class="button-style" onclick="saveNewHotel()">ä¿å­˜é…’åº—</button>
                        <button class="button-style" onclick="closeNewHotelForm()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="header" id="listHeader">
            <h1>é…’åº—è¯¦æƒ…</h1>
            <button class="small-button" id="toggleBtn" onclick="toggleDetails()">å±•å¼€</button>
        </div>
        <div class="hotel-list" id="hotelList"></div>
    </div>

    <div class="footer-buttons">
        <button class="button-style" onclick="showHome()">è¿”å›é¦–é¡µ</button>
        <button class="button-style" onclick="openLifeMuseum()">æ¬¢å–œç”Ÿæ´»é¦†</button>
    </div>
    
    <div class="save-notice" id="saveNotice">âœ“ ä¿å­˜æˆåŠŸï¼</div>

    <script>
        let fullHotels=[{name:"æ¡”å­é…’åº— (è¥¿å®‰é«˜æ–°åŒºé”¦ä¸šè·¯åº—)",address:"ä¸ˆå…«ä¸€è·¯ä¸é”¦ä¸šè·¯äº¤å‰å£ä¸œåŒ—è§’æ—ºéƒ½å¤§å¦Cåº§5æ¥¼",phone:"+86 29-6825-9777",rooms:"çº¦80-100é—´",distance:0.4},{name:"å¦‚å®¶ç²¾é€‰é…’åº— (è¥¿å®‰é«˜æ–°åŒºé”¦ä¸šä¸€è·¯ä¸ˆå…«å››è·¯åœ°é“ç«™åº—)",address:"é”¦ä¸šä¸€è·¯56å·",phone:"+86 29-6859-6666",rooms:"çº¦100-120é—´",distance:1.4},{name:"å…¨ä½é…’åº—(åŠå¯¼ä½“äº§ä¸šå›­ä¸ˆå…«å…­è·¯åœ°é“å£åº—)",address:"é”¦ä¸šè·¯é™„è¿‘",phone:"+86 29-8866-1234",rooms:"çº¦60-80é—´",distance:0.5}];
        const savedData=JSON.parse(localStorage.getItem('hotelData'))||{};
        let currentDisplayedIndexes=[];

        function generateHotelList(hotels){
            const hotelList=document.getElementById('hotelList');
            hotelList.innerHTML='';
            currentDisplayedIndexes=hotels.map(h=>fullHotels.indexOf(h));
            document.getElementById('listHeader').style.display='flex';
            hotels.forEach((hotel,listIndex)=>{
                const originalIndex=fullHotels.indexOf(hotel);
                const saved=savedData[originalIndex]||{status:'å¾…å®š',remarks:'',checked:false,collapsed:true,distance:hotel.distance,address:hotel.address,phone:hotel.phone,rooms:hotel.rooms,editable:false};
                const item=document.createElement('div');
                item.className=`hotel-item${saved.collapsed?' collapsed':''}`;
                item.innerHTML=`<div class="hotel-name" onclick="toggleHotel(${originalIndex},event)">
                        <div class="controls-container">
                            <div class="controls">
                                <input type="checkbox" ${saved.checked?'checked':''} onchange="updateChecked(${originalIndex},this.checked)">
                                <select onchange="updateStatus(${originalIndex},this.value)" style="padding:4px;border-radius:4px;margin-left:8px">
                                    ${['å¾…å®š','è·Ÿè¿›','åˆä½œ','æ”¾å¼ƒ'].map(v=>`<option ${saved.status===v?'selected':''}>${v}</option>`).join('')}
                                </select>
                                ${saved.editable?`<button class="delete-btn" onclick="deleteHotel(${originalIndex})">åˆ é™¤</button>`:''}
                            </div>
                            <span class="distance-link" onclick="openMap('${hotel.name}')">${(saved.distance||hotel.distance).toFixed(1)}km</span>
                        </div>
                        <div style="margin-top:8px">${hotel.name}</div>
                    </div>
                    <div class="details">
                        <div class="detail-item">
                            <label>åœ°å€ï¼š</label>
                            <input value="${saved.address||hotel.address}" onchange="updateAddress(${originalIndex},this.value)" ${saved.editable?'':'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>ç”µè¯ï¼š</label>
                            <input value="${saved.phone||hotel.phone}" onchange="updatePhone(${originalIndex},this.value)" ${saved.editable?'':'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>æˆ¿é—´ï¼š</label>
                            <input value="${saved.rooms||hotel.rooms}" onchange="updateRooms(${originalIndex},this.value)" ${saved.editable?'':'disabled'}>
                        </div>
                        <div class="detail-item">
                            <label>å¤‡æ³¨ï¼š</label>
                            <textarea onchange="updateRemarks(${originalIndex},this.value)" ${saved.editable?'':'disabled'}>${saved.remarks||''}</textarea>
                        </div>
                        <div class="detail-item">
                            <label>è·ç¦»ï¼š</label>
                            <div class="distance-row">
                                <input class="distance-input" type="number" step="0.1" value="${(saved.distance||hotel.distance).toFixed(1)}" onchange="updateDistance(${originalIndex},this.value)" ${saved.editable?'':'disabled'}>
                                <span>km</span>
                                <button class="small-button" onclick="toggleEdit(${originalIndex})">${saved.editable?'ä¿å­˜':'ä¿®æ”¹'}</button>
                            </div>
                        </div>
                    </div>`;
                hotelList.appendChild(item);
            });
            hotelList.style.display='block';
        }

        function deleteHotel(index){
            if(confirm("ç¡®å®šè¦æ°¸ä¹…åˆ é™¤è¯¥é…’åº—å—ï¼Ÿ")){
                fullHotels.splice(index,1);
                delete savedData[index];
                localStorage.setItem('hotelData',JSON.stringify(savedData));
                searchHotels();
            }
        }

        function showNewHotelForm(){
            document.getElementById('newHotelForm').style.display='block';
            ['Name','Address','Phone','Rooms','Distance'].forEach(id=>{
                document.getElementById(`newHotel${id}`).value='';
            });
        }

        function closeNewHotelForm(){
            document.getElementById('newHotelForm').style.display='none';
        }

        function saveNewHotel(){
            const newHotel={
                name:document.getElementById('newHotelName').value.trim(),
                address:document.getElementById('newHotelAddress').value.trim(),
                phone:document.getElementById('newHotelPhone').value.trim(),
                rooms:document.getElementById('newHotelRooms').value.trim(),
                distance:parseFloat(document.getElementById('newHotelDistance').value)
            };
            if(!newHotel.name||isNaN(newHotel.distance))return alert('è¯·å¡«å†™é…’åº—åç§°å’Œæœ‰æ•ˆè·ç¦»');
            fullHotels.push(newHotel);
            const newIndex=fullHotels.length-1;
            savedData[newIndex]={status:'å¾…å®š',remarks:'',checked:false,collapsed:false,editable:true,...newHotel};
            localStorage.setItem('hotelData',JSON.stringify(savedData));
            document.getElementById('searchInput').value='';
            document.getElementById('searchStatus').value='';
            closeNewHotelForm();
            showSaveNotice('é…’åº—æ·»åŠ æˆåŠŸï¼');
            searchHotels();
        }

function exportData() {
    try {
        // å‡†å¤‡æ•°æ®
        const data = {
            fullHotels: fullHotels,
            savedData: savedData,
            version: new Date().toISOString()
        };
        const content = JSON.stringify(data, null, 2);
        const filename = `é…’åº—æ•°æ®_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;

        // å¾®ä¿¡ç¯å¢ƒç‰¹æ®Šå¤„ç†
        if (/MicroMessenger/i.test(navigator.userAgent)) {
            // åˆ›å»ºä¸‹è½½å¼•å¯¼ç•Œé¢
            const exportGuide = document.createElement('div');
            exportGuide.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 9999;
                color: white;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                padding: 20px;
            `;

            // å¼•å¯¼å†…å®¹
            exportGuide.innerHTML = `
                <h3 style="margin-bottom:20px">ğŸ“ å¯¼å‡ºæ“ä½œæŒ‡å¼•</h3>
                <p>1. ç‚¹å‡»å³ä¸Šè§’ Â·Â·Â· æŒ‰é’®</p>
                <p>2. é€‰æ‹©ã€Œåœ¨æµè§ˆå™¨æ‰“å¼€ã€</p>
                <p>3. é‡æ–°ç‚¹å‡»å¯¼å‡ºæŒ‰é’®</p>
                <div style="margin:30px 0;border-top:1px solid #666;width:80%"></div>
                <p>æˆ–æ‰«æäºŒç»´ç åœ¨ç”µè„‘ç«¯æ“ä½œï¼š</p>
                <img id="exportQrcode" style="width:200px;height:200px;margin:15px">
                <button onclick="this.parentElement.remove()" 
                    style="padding:8px 20px;background:#4a90e2;border:none;color:white;border-radius:5px;margin-top:15px">
                    å…³é—­æç¤º
                </button>
            `;

            // ç”ŸæˆäºŒç»´ç 
            const pageUrl = encodeURIComponent(window.location.href);
            exportGuide.querySelector('#exportQrcode').src = 
                `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${pageUrl}`;

            document.body.appendChild(exportGuide);
            return;
        }

        // æ­£å¸¸æµè§ˆå™¨å¤„ç†
        if (window.Blob && window.URL) {
            // ç°ä»£æµè§ˆå™¨æ–¹æ¡ˆ
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            
            // æ¸…ç†èµ„æº
            setTimeout(() => {
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }, 100);
        } else {
            // å…¼å®¹æ—§æµè§ˆå™¨çš„å¤‡ç”¨æ–¹æ¡ˆ
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'data:application/json;charset=utf-8,' + encodeURIComponent(content);
            document.body.appendChild(iframe);
            setTimeout(() => document.body.removeChild(iframe), 1000);
        }

        // æ˜¾ç¤ºæˆåŠŸæç¤º
        showSaveNotice('æ•°æ®å¯¼å‡ºå·²è§¦å‘ï¼Œè¯·æŸ¥çœ‹ä¸‹è½½æ–‡ä»¶');

    } catch (error) {
        console.error('å¯¼å‡ºå¤±è´¥:', error);
        showSaveNotice(`å¯¼å‡ºå¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`);
    }
}

// æ˜¾ç¤ºä¿å­˜æç¤ºçš„å‡½æ•°éœ€è¦ä¿æŒä¸ä¹‹å‰ä¸€è‡´
function showSaveNotice(message) {
    const notice = document.getElementById('saveNotice');
    notice.textContent = message;
    notice.style.display = 'block';
    setTimeout(() => notice.style.display = 'none', 3000);
}
        function importData(event){
            const file=event.target.files[0];
            if(!file)return;
            const reader=new FileReader();
            reader.onload=function(e){
                try{
                    const data=JSON.parse(e.target.result);
                    if(!data.fullHotels||!data.savedData)throw new Error('æ— æ•ˆæ•°æ®æ–‡ä»¶');
                    if(confirm("å¯¼å…¥æ•°æ®å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ")){
                        fullHotels=data.fullHotels;
                        savedData=data.savedData;
                        localStorage.setItem('hotelData',JSON.stringify(savedData));
                        alert('å¯¼å…¥æˆåŠŸï¼Œå³å°†åˆ·æ–°é¡µé¢');
                        location.reload();
                    }
                }catch(e){alert('æ–‡ä»¶è§£æå¤±è´¥: '+e.message)}
            };
            reader.readAsText(file);
        }

        function showSaveNotice(message){
            const notice=document.getElementById('saveNotice');
            notice.textContent=message;
            notice.style.display='block';
            setTimeout(()=>notice.style.display='none',2000);
        }

        function searchHotels(){
            const searchTerm=document.getElementById('searchInput').value.toLowerCase();
            const statusFilter=document.getElementById('searchStatus').value;
            const distanceCheckboxes=document.querySelectorAll('.distance-options input[type="checkbox"]:checked');
            const distanceRanges=Array.from(distanceCheckboxes).map(c=>c.value);
            
            let filtered=fullHotels.filter(hotel=>{
                const nameMatch=hotel.name.toLowerCase().includes(searchTerm);
                const statusMatch=!statusFilter||(savedData[fullHotels.indexOf(hotel)]?.status===statusFilter);
                const distance=hotel.distance;
                const distanceMatch=distanceRanges.some(range=>{
                    if(range==='all')return true;
                    if(range==='0-1')return distance<=1;
                    if(range==='1-2')return distance>1&&distance<=2;
                    if(range==='2-3')return distance>2&&distance<=3;
                    if(range==='3-4')return distance>3&&distance<=4;
                    if(range==='4+')return distance>4;
                    return false;
                });
                return nameMatch&&statusMatch&&distanceMatch;
            });
            generateHotelList(filtered);
            document.getElementById('homePage').style.display='none';
        }

        function showRandomHotels(){
            const randomHotels=fullHotels.sort(()=>Math.random()-0.5).slice(0,5);
            generateHotelList(randomHotels);
            document.getElementById('homePage').style.display='none';
        }

        function toggleHotel(index,event){
            if(event.target.tagName==='INPUT'||event.target.tagName==='SELECT'||event.target.tagName==='BUTTON')return;
            const hotelItem=event.currentTarget.closest('.hotel-item');
            hotelItem.classList.toggle('collapsed');
            savedData[index].collapsed=!savedData[index].collapsed;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateStatus(index,value){
            savedData[index]=savedData[index]||{};
            savedData[index].status=value;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateChecked(index,checked){
            savedData[index]=savedData[index]||{};
            savedData[index].checked=checked;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateAddress(index,value){
            savedData[index].address=value;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updatePhone(index,value){
            savedData[index].phone=value;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateRooms(index,value){
            savedData[index].rooms=value;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateRemarks(index,value){
            savedData[index].remarks=value;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function updateDistance(index,value){
            savedData[index].distance=parseFloat(value);
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function toggleEdit(index){
            savedData[index].editable=!savedData[index].editable;
            localStorage.setItem('hotelData',JSON.stringify(savedData));
            searchHotels();
        }

        function toggleDetails(){
            const btn=document.getElementById('toggleBtn');
            const isCollapsed=btn.textContent==='å±•å¼€';
            btn.textContent=isCollapsed?'æŠ˜å ':'å±•å¼€';
            document.querySelectorAll('.hotel-item').forEach(item=>{
                item.classList.toggle('collapsed',!isCollapsed);
                const index=currentDisplayedIndexes[Array.from(item.parentNode.children).indexOf(item)];
                if(index!==undefined)savedData[index].collapsed=!isCollapsed;
            });
            localStorage.setItem('hotelData',JSON.stringify(savedData));
        }

        function showHome(){
            document.getElementById('homePage').style.display='block';
            document.getElementById('listHeader').style.display='none';
            document.getElementById('hotelList').style.display='none';
        }

        function openMap(name){
                     window.open(`https://uri.amap.com/search?query=${encodeURIComponent(name)}&city=è¥¿å®‰`);
        }

        function openLifeMuseum() {
            window.open('http://www.thisnet.cn/wxurl/mini.php');
        }

        showHome();
    </script>
</body>
</html>
